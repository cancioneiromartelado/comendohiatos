<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Escansão Poética</title>
<style>
:root{--bg:#0b0d12;--card:#121521;--muted:#8fa0b3;--text:#e6ecf3;--accent:#79b8ff;--ok:#3fb950;--warn:#d29922;--info:#58a6ff;--merge:#1f6feb;--del:#f85149;}
*{box-sizing:border-box;}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--text);}
header{padding:20px;border-bottom:1px solid #1e2433;background:#0c1018;}
h1{font-size:20px;margin:0;letter-spacing:0.2px;}
main{max-width:1200px;margin:0 auto;padding:20px;}
.card{background:var(--card);border:1px solid #20283a;border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);}
textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a3347;background:#0e1320;color:var(--text);resize:vertical;min-height:90px;}
button{background:#101a2b;border:1px solid #2a3347;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;}
button:hover{border-color:var(--accent);}
.muted{color:var(--muted);font-size:13px;}
.section-title{font-weight:700;margin:14px 0 8px;letter-spacing:.2px;}
code{background:#0e1320;border:1px solid #2a3347;padding:2px 6px;border-radius:6px;}
.strike{text-decoration:line-through;color:#f85149;}
.steps li{margin-bottom:6px;}
</style>
</head>
<body>
<header><h1>Escansão Poética — Protótipo</h1></header>
<main>
<div class="card">
<label class="section-title" for="texto">Verso/frase</label>
<textarea id="texto" placeholder="Ex.: Amor e ódio andavam lado a lado">Amor e ódio andavam lado a lado</textarea>
<div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
<button id="analisar">Analisar</button>
<button id="gerarVariacoes">Gerar variações</button>
<span class="muted">O passo a passo evidencia sinérese, elisão e sinalefa.</span>
</div>
<div id="saidaOverview" class="muted" style="margin-top:10px;">Nenhuma análise ainda.</div>
<div id="passos"></div>
<div id="variantes"></div>
</div>
<script>
const V="aeiouáéíóúâêôãõà";
const AC=/[áéíóúâêôãõà]/;
const DIT=["ai","ei","oi","ui","au","eu","ou","ia","ie","io","iu","ua","ue","uo","ão","õe","ãi","uai","uau","uei","iau","iao","iei","uou"];
function isVowel(ch){return V.includes((ch||'').toLowerCase());}
function normalize(s){return s.replace(/[^\p{L}\p{M}\s'’-]/gu,' ').replace(/\s+/g,' ').trim();}
function tokenize(s){return s.split(/\s+/).filter(Boolean);}
function splitSyllablesWord(word){
  const w=word.toLowerCase(),out=[],res=[];
  let syl='';
  for(let i=0;i<w.length;i++){
    syl+=word[i];
    if(isVowel(w[i])){
      for(let span=3;span>=2;span--){
        const seg=w.slice(i,i+span);
        if(DIT.includes(seg)){syl=syl.slice(0,-1)+word.slice(i,i+span);i+=span-1;break;}
      }
      out.push(syl);syl='';
    }
  }
  if(syl) out.push(syl);
  for(let s of out){
    if(![...s].some(isVowel)&&res.length) res[res.length-1]+=s; else res.push(s);
  }
  return res.filter(Boolean);
}
function stressedIndex(word, syls){
  for(let i=0;i<syls.length;i++) if(AC.test(syls[i])) return i;
  return syls.length-1;
}
function applyElision(wordsSyls){
  const res=[],events=[];
  for(let i=0;i<wordsSyls.length;i++){
    const curr=wordsSyls[i].slice();
    if(res.length===0){res.push(curr);continue;}
    const prev=res[res.length-1];
    const last=prev[prev.length-1];
    const first=curr[0];
    if(/^[^aeiou]*[aeo]$/i.test(last)&&!AC.test(last)&&isVowel(first[0])){
      events.push({drop:last,next:first});
      prev[prev.length-1]='<span class="strike">'+last+'</span>';
    }
    res.push(curr);
  }
  return {wordsSyls:res,events};
}
function applySinalefa(wordsSyls){
  const res=[],events=[];
  for(let i=0;i<wordsSyls.length;i++){
    const curr=wordsSyls[i].slice();
    if(res.length===0){res.push(curr);continue;}
    const prev=res[res.length-1];
    const last=prev[prev.length-1];
    const first=curr[0];
    const lastCh=(last||'').slice(-1).toLowerCase();
    const f0=(first||'')[0]?.toLowerCase()||'';
    const f1=(first||'')[1]?.toLowerCase()||'';
    const startsV=isVowel(f0)||(f0==='h'&&isVowel(f1));
    if(isVowel(lastCh)&&startsV){
      const merged=last+(f0==='h'?first.slice(1):first);
      events.push({left:last,right:first,res:merged});
      prev[prev.length-1]=merged;
      const rest=curr.slice(1); if(rest.length) res.push(rest);
    }else res.push(curr);
  }
  return {wordsSyls:res,events};
}
function analyzeStep(text){
  const words=tokenize(text);
  const grams=words.map(w=>splitSyllablesWord(w));
  const base=grams.map(g=>({syls:g}));
  const afterEl=applyElision(base.map(b=>b.syls.slice()));
  const afterSi=applySinalefa(afterEl.wordsSyls.map(x=>x.slice()));
  const last=words[words.length-1];
  const stress=stressedIndex(last,base[base.length-1].syls);
  const linear=afterSi.wordsSyls.flat();
  const poeticCount=linear.length;
  return {words,grams,afterEl,afterSi,stress,poeticCount};
}
function render(result){
  const {words,grams,afterEl,afterSi,stress,poeticCount}=result;
  const gramTable=words.map((w,i)=>`<tr><td><b>${w}</b></td><td>${grams[i].map(s=>`<code>${s}</code>`).join(' · ')}</td><td>${grams[i].length}</td></tr>`).join('');
  const elList=(afterEl.events||[]).map(ev=>`<li>Elisão: ${ev.next} [${ev.drop} eliminado]</li>`).join('');
  const siList=(afterSi.events||[]).map(ev=>`<li>Sinalefa: ${ev.left}+${ev.right} → ${ev.res}</li>`).join('');
  document.getElementById('saidaOverview').innerHTML=`<b>Contagem poética:</b> ${poeticCount} sílabas`;
  document.getElementById('passos').innerHTML=`
  <div class="section-title">Passo a passo</div>
  <ol class="steps">
  <li>Silabação gramatical
  <table><tr><th>Palavra</th><th>Sílabas</th><th>Total</th></tr>${gramTable}</table>
  </li>
  <li>Aplicar elisão
  <ul>${elList||'<li>Nenhuma elisão aplicada</li>'}</ul></li>
  <li>Aplicar sinalefa
  <ul>${siList||'<li>Nenhuma sinalefa aplicada</li>'}</ul></li>
  <li>Tônica da última palavra: ${words[words.length-1]} → <b>${grams[grams.length-1][stress]}</b></li>
  </ol>`;
}
document.getElementById('analisar').addEventListener('click',()=>{const t=document.getElementById('texto').value;render(analyzeStep(t));});
</script>
</body>
</html>
